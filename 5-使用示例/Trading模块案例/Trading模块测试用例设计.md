# 区块链交易系统Trade模块测试用例设计文档

## 文档信息
- **文档名称**: 区块链交易系统Trade模块测试用例设计文档
- **文档版本**: v2.0
- **创建日期**: 2025年7月
- **最后更新**: 2025年7月
- **文档状态**: 开发中
- **总用例数**: 162条用例，覆盖11个测试场景

## 1. 文档概述

### 1.1 项目背景
本文档针对区块链交易系统Trade模块的核心交易功能进行全面的测试用例设计，确保系统的稳定性、安全性和准确性。

### 1.2 测试目标
- **功能覆盖**: 实现区块链交易系统Trade模块核心功能100%覆盖
- **质量保障**: 确保交易流程的准确性和资金安全
- **风险控制**: 验证各种异常情况下的系统表现
- **用户体验**: 保障交易操作的流畅性和可靠性

### 1.3 测试范围
- ✅ 订单管理（下单、撤单、修改）
- ✅ 仓位管理（开仓、平仓、参数调整）
- ✅ 风控管理（资金检查、强平机制）
- ✅ 数据管理（一致性、历史记录）
- ✅ 批量操作（批量处理能力）
- ✅ 权限安全（访问控制、安全验证）

## 2. 系统功能分析

### 2.1 核心接口清单

| 接口名称 | 接口描述 | 重要程度 |
| :--- | :--- | :--- |
| 获取账户持仓信息 | 查询用户当前持有的仓位信息 | 🔥 核心 |
| 下单接口 | 创建新的买入或卖出订单 | 🔥 核心 |
| 平仓接口 | 平掉用户当前持有的部分或全部仓位 | 🔥 核心 |
| 查询账户余额接口 | 查询用户的账户资产余额 | 🔥 核心 |
| 修改订单接口 | 修改尚未成交的委托订单参数 | ⭐ 重要 |
| 撤单接口 | 取消一个尚未成交的委托订单 | ⭐ 重要 |
| 查询当前委托接口 | 查询用户当前所有未成交的委托订单 | ⭐ 重要 |
| 修改当前仓位接口 | 修改仓位的止盈止损参数 | ⭐ 重要 |
| 批量下单接口 | 一次性提交多个新订单 | 💡 扩展 |
| 批量撤单接口 | 一次性取消多个未成交的委托订单 | 💡 扩展 |
| 查询历史订单接口 | 查询指定时间范围内的历史订单记录 | 💡 扩展 |
| 查询历史持仓接口 | 查询用户已平仓的历史仓位记录 | 💡 扩展 |
| 查询订单成交明细接口 | 查询订单的详细成交记录 | 💡 扩展 |

### 2.2 交易参数维度

#### 订单类型
- **Market (M)**: 市价单 - 按当前市场价格立即成交
- **Limit (L)**: 限价单 - 按指定价格挂单等待成交

#### 仓位模式
- **Cross (C)**: 全仓模式 - 使用账户全部可用余额作为保证金
- **Isolated (I)**: 逐仓模式 - 为每个仓位分配独立的保证金

#### 交易方向
- **Long (L)**: 做多 - 买入开仓，预期价格上涨
- **Short (S)**: 做空 - 卖出开仓，预期价格下跌

#### 止盈止损配置
- **无**: 不设置止盈止损
- **TP**: 仅设置止盈 (Take Profit)
- **SL**: 仅设置止损 (Stop Loss)
- **TS**: 同时设置止盈止损 (Take Profit & Stop Loss)

## 3. 测试策略与原则

### 3.1 测试策略
- **分层测试**: 按功能重要性分P0/P1/P2三个优先级
- **模块化设计**: 每个场景独立设计，便于维护和执行
- **全面覆盖**: 覆盖正常流程、边界条件和异常情况
- **数据驱动**: 基于不同参数组合生成测试用例

### 3.2 测试原则
- **安全第一**: 优先验证资金安全和风控机制
- **用户体验**: 确保核心交易流程的流畅性
- **数据准确**: 验证所有计算和状态的准确性
- **异常处理**: 确保系统在异常情况下的稳定性

### 3.3 通用注意事项

#### 限价单价格设置原则
**🔄 需要立即成交的场景**（如开仓+平仓、开仓+修改仓位等）：
- **目的**: 确保测试流程的连续性
- **做多设置**: 限价价格应高于或等于当前市价
- **做空设置**: 限价价格应低于或等于当前市价
- **示例**: 当前价格4000时，限价4020做多或限价3980做空均可立即成交

**⏳ 需要挂单等待的场景**（如限价单生命周期管理）：
- **目的**: 验证挂单和订单管理功能
- **做多设置**: 限价价格应低于当前市价
- **做空设置**: 限价价格应高于当前市价

#### 测试数据要求
- **账户余额**: 确保测试账户有足够余额进行各种操作
- **价格精度**: 遵循系统设定的价格精度要求
- **数量限制**: 符合最小/最大交易数量限制
- **时间同步**: 确保测试环境时间同步准确

## 4. 测试场景设计

### 4.1 场景分类原则
- **核心流程场景**: 验证基本交易生命周期
- **功能扩展场景**: 验证高级功能和操作
- **异常处理场景**: 验证边界条件和错误处理
- **性能安全场景**: 验证系统性能和安全控制

### 4.2 优先级分配

#### P0优先级 - 核心功能（64条用例）
🔥 **最高优先级，必须优先完成**
- 场景1: 基础开仓+平仓流程 (32条)
- 场景4: 限价单生命周期 (8条)
- 场景2: 仓位参数修改 (24条)

#### P1优先级 - 重要功能（52条用例）
⭐ **重要功能，影响用户体验**
- 场景10: 数据一致性场景 (12条)
- 场景9: 批量操作场景 (16条)
- 场景5: 订单修改与撤单 (12条)
- 场景11: 权限与安全场景 (8条)
- 场景3: 仓位自动合并 (4条)

#### P2优先级 - 辅助功能（14条用例）
💡 **辅助功能，提升系统完整性**
- 场景7: 历史数据场景 (8条)
- 场景8: 系统配置场景 (6条)

### 4.3 场景详细设计

## 5. P0优先级测试场景（核心功能）

### 场景1: 基础开仓+平仓流程 【P0优先级】

#### 5.1.1 场景概述
- **场景目标**: 验证完整的交易生命周期，从开仓到平仓的全流程
- **业务重要性**: ⭐⭐⭐⭐⭐ 最核心的交易功能
- **用例数量**: 32条用例
- **覆盖维度**: 订单类型(2) × 仓位模式(2) × 交易方向(2) × 止盈止损(4) = 32条

#### 5.1.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 订单类型 | Market(M), Limit(L) | 市价单、限价单 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |
| 止盈止损 | 无, TP, SL, TS | 不设置、仅止盈、仅止损、止盈止损 |

#### 5.1.3 关联接口
- **主要接口**: 查询账户余额、下单接口、查询当前持仓、平仓接口
- **辅助接口**: 查询历史持仓、查询订单成交明细

#### 5.1.4 测试流程
```
前置条件检查 → 开仓操作 → 仓位验证 → 部分平仓 → 全部平仓 → 结果验证
```

#### 5.1.5 详细验证步骤
1. **前置条件验证**
   - 查询当前保证金余额，确保余额充足
   - 确认账户状态正常，无风险限制
   - 验证交易对可正常交易

2. **开仓操作执行**
   - 根据测试参数执行开仓操作
   - 验证订单提交成功
   - 确认订单状态正确

3. **开仓后状态验证**
   - 查询当前仓位，确认仓位存在且参数正确
   - 验证仓位保证金计算准确
   - 查询开仓后保证金余额，确认保证金正常扣除
   - 验证止盈止损设置（如有）

4. **部分平仓操作**
   - 执行部分平仓操作（平仓50%仓位）
   - 查询当前仓位，确认部分平仓成功
   - 验证剩余仓位数量和保证金

5. **全部平仓操作**
   - 执行全部平仓操作
   - 查询当前仓位，确认仓位已不存在
   - 验证平仓后账户状态

6. **最终结果验证**
   - 查看历史仓位，确认历史记录完整
   - 记录并验证仓位盈亏计算
   - 确认最终保证金余额 = 开仓前余额 ± 仓位盈亏 - 手续费

#### 5.1.6 预期结果
- ✅ 所有操作执行成功，无错误提示
- ✅ 仓位状态变化准确，数据一致
- ✅ 保证金计算正确，资金安全
- ✅ 历史记录完整，可追溯
- ✅ 盈亏计算准确，符合预期

#### 5.1.7 测试用例清单

**市价-全仓-做多 (Market-Cross-Long)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 01_Trade_C_M_L | 市价全仓做多不带止盈止损_基础开仓平仓流程 | Market | Cross | Long | 无 |
| 02_Trade_C_M_L_TP | 市价全仓做多带止盈_基础开仓平仓流程 | Market | Cross | Long | TP |
| 03_Trade_C_M_L_SL | 市价全仓做多带止损_基础开仓平仓流程 | Market | Cross | Long | SL |
| 04_Trade_C_M_L_TS | 市价全仓做多带止盈止损_基础开仓平仓流程 | Market | Cross | Long | TS |

**市价-全仓-做空 (Market-Cross-Short)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 05_Trade_C_M_S | 市价全仓做空不带止盈止损_基础开仓平仓流程 | Market | Cross | Short | 无 |
| 06_Trade_C_M_S_TP | 市价全仓做空带止盈_基础开仓平仓流程 | Market | Cross | Short | TP |
| 07_Trade_C_M_S_SL | 市价全仓做空带止损_基础开仓平仓流程 | Market | Cross | Short | SL |
| 08_Trade_C_M_S_TS | 市价全仓做空带止盈止损_基础开仓平仓流程 | Market | Cross | Short | TS |

**限价-全仓-做多 (Limit-Cross-Long)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 09_Trade_C_L_L | 限价全仓做多不带止盈止损_基础开仓平仓流程 | Limit | Cross | Long | 无 |
| 10_Trade_C_L_L_TP | 限价全仓做多带止盈_基础开仓平仓流程 | Limit | Cross | Long | TP |
| 11_Trade_C_L_L_SL | 限价全仓做多带止损_基础开仓平仓流程 | Limit | Cross | Long | SL |
| 12_Trade_C_L_L_TS | 限价全仓做多带止盈止损_基础开仓平仓流程 | Limit | Cross | Long | TS |

**限价-全仓-做空 (Limit-Cross-Short)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 13_Trade_C_L_S | 限价全仓做空不带止盈止损_基础开仓平仓流程 | Limit | Cross | Short | 无 |
| 14_Trade_C_L_S_TP | 限价全仓做空带止盈_基础开仓平仓流程 | Limit | Cross | Short | TP |
| 15_Trade_C_L_S_SL | 限价全仓做空带止损_基础开仓平仓流程 | Limit | Cross | Short | SL |
| 16_Trade_C_L_S_TS | 限价全仓做空带止盈止损_基础开仓平仓流程 | Limit | Cross | Short | TS |

**市价-逐仓-做多 (Market-Isolated-Long)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 17_Trade_I_M_L | 市价逐仓做多不带止盈止损_基础开仓平仓流程 | Market | Isolated | Long | 无 |
| 18_Trade_I_M_L_TP | 市价逐仓做多带止盈_基础开仓平仓流程 | Market | Isolated | Long | TP |
| 19_Trade_I_M_L_SL | 市价逐仓做多带止损_基础开仓平仓流程 | Market | Isolated | Long | SL |
| 20_Trade_I_M_L_TS | 市价逐仓做多带止盈止损_基础开仓平仓流程 | Market | Isolated | Long | TS |

**市价-逐仓-做空 (Market-Isolated-Short)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 21_Trade_I_M_S | 市价逐仓做空不带止盈止损_基础开仓平仓流程 | Market | Isolated | Short | 无 |
| 22_Trade_I_M_S_TP | 市价逐仓做空带止盈_基础开仓平仓流程 | Market | Isolated | Short | TP |
| 23_Trade_I_M_S_SL | 市价逐仓做空带止损_基础开仓平仓流程 | Market | Isolated | Short | SL |
| 24_Trade_I_M_S_TS | 市价逐仓做空带止盈止损_基础开仓平仓流程 | Market | Isolated | Short | TS |

**限价-逐仓-做多 (Limit-Isolated-Long)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 25_Trade_I_L_L | 限价逐仓做多不带止盈止损_基础开仓平仓流程 | Limit | Isolated | Long | 无 |
| 26_Trade_I_L_L_TP | 限价逐仓做多带止盈_基础开仓平仓流程 | Limit | Isolated | Long | TP |
| 27_Trade_I_L_L_SL | 限价逐仓做多带止损_基础开仓平仓流程 | Limit | Isolated | Long | SL |
| 28_Trade_I_L_L_TS | 限价逐仓做多带止盈止损_基础开仓平仓流程 | Limit | Isolated | Long | TS |

**限价-逐仓-做空 (Limit-Isolated-Short)**

| 用例编号 | 用例名称 | 订单类型 | 仓位模式 | 交易方向 | 止盈止损 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 29_Trade_I_L_S | 限价逐仓做空不带止盈止损_基础开仓平仓流程 | Limit | Isolated | Short | 无 |
| 30_Trade_I_L_S_TP | 限价逐仓做空带止盈_基础开仓平仓流程 | Limit | Isolated | Short | TP |
| 31_Trade_I_L_S_SL | 限价逐仓做空带止损_基础开仓平仓流程 | Limit | Isolated | Short | SL |
| 32_Trade_I_L_S_TS | 限价逐仓做空带止盈止损_基础开仓平仓流程 | Limit | Isolated | Short | TS |

**说明**:
- 场景1共包含32条测试用例（01-32号）
- 覆盖订单类型(2) × 仓位模式(2) × 交易方向(2) × 止盈止损(4) = 32条
- 每个用例都包含完整的开仓到平仓流程

### 场景4: 限价单生命周期 【P0优先级】

#### 5.4.1 场景概述
- **场景目标**: 验证限价单从创建到结束的完整生命周期管理
- **业务重要性**: ⭐⭐⭐⭐⭐ 订单管理核心功能
- **用例数量**: 8条用例
- **覆盖维度**: 仓位模式(2) × 交易方向(2) × 订单状态(2) = 8条

#### 5.4.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |
| 订单状态 | 挂单、撤单 | 限价单的主要状态 |

#### 5.4.3 关联接口
- **主要接口**: 下单接口、查询当前委托、撤单接口、修改订单接口
- **辅助接口**: 查询账户余额、查询历史订单、查询成交明细

#### 5.4.4 测试流程
```
订单创建 → 状态跟踪 → 订单操作 → 状态验证 → 结果确认
```

#### 5.4.5 详细验证步骤
1. **订单创建验证**
   - 提交限价单（价格设置为不立即成交）
   - 验证订单创建成功
   - 确认订单状态为"挂单"

2. **订单状态跟踪**
   - 查询当前委托，确认订单存在
   - 验证订单参数正确（价格、数量、方向等）
   - 监控订单状态变化

3. **订单操作执行**
   - 根据测试场景执行相应操作：
     - 执行撤单操作

4. **状态变化验证**
   - 验证订单状态正确转换
   - 确认撤单操作及时生效

5. **最终结果确认**
   - 查询历史订单，确认记录完整
   - 验证账户余额变化
   - 确认手续费扣除正确

#### 5.4.6 预期结果
- ✅ 订单状态转换准确，符合业务逻辑
- ✅ 撤单操作及时有效
- ✅ 历史记录完整可查
- ✅ 资金状态保持正确

#### 5.4.7 测试用例清单

**全仓-做多 (Cross-Long)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 订单状态 |
| :--- | :--- | :--- | :--- | :--- |
| 33_Trade_C_L_Pending | 限价全仓做多_挂单状态验证 | Cross | Long | 挂单 |
| 34_Trade_C_L_Cancelled | 限价全仓做多_撤单验证 | Cross | Long | 撤单 |

**全仓-做空 (Cross-Short)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 订单状态 |
| :--- | :--- | :--- | :--- | :--- |
| 35_Trade_C_S_Pending | 限价全仓做空_挂单状态验证 | Cross | Short | 挂单 |
| 36_Trade_C_S_Cancelled | 限价全仓做空_撤单验证 | Cross | Short | 撤单 |

**逐仓-做多 (Isolated-Long)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 订单状态 |
| :--- | :--- | :--- | :--- | :--- |
| 37_Trade_I_L_Pending | 限价逐仓做多_挂单状态验证 | Isolated | Long | 挂单 |
| 38_Trade_I_L_Cancelled | 限价逐仓做多_撤单验证 | Isolated | Long | 撤单 |

**逐仓-做空 (Isolated-Short)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 订单状态 |
| :--- | :--- | :--- | :--- | :--- |
| 39_Trade_I_S_Pending | 限价逐仓做空_挂单状态验证 | Isolated | Short | 挂单 |
| 40_Trade_I_S_Cancelled | 限价逐仓做空_撤单验证 | Isolated | Short | 撤单 |

**说明**:
- 场景4共包含8条测试用例（33-40号）
- 覆盖仓位模式(2) × 交易方向(2) × 订单状态(2) = 8条
- 每个用例都包含详细的状态验证和操作流程

### 场景2: 仓位参数修改 【P0优先级】

#### 5.2.1 场景概述
- **场景目标**: 验证仓位止盈止损参数的动态修改功能
- **业务重要性**: ⭐⭐⭐⭐ 风险管理重要工具
- **用例数量**: 24条用例
- **覆盖维度**: 仓位模式(2) × 交易方向(2) × 修改类型(6) = 24条

#### 5.2.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |
| 修改类型 | 添加TP、添加SL、添加TS、修改TP、修改SL、取消TS | 6种修改操作 |

#### 5.2.3 关联接口
- **主要接口**: 下单接口、查询当前持仓、修改当前仓位接口、平仓接口
- **辅助接口**: 查询账户余额、查询历史持仓

#### 5.2.4 测试流程
```
开仓操作 → 仓位确认 → 修改参数 → 参数验证 → 平仓操作 → 结果验证
```

#### 5.2.5 详细验证步骤
1. **开仓操作**
   - 执行开仓操作（市价单，确保立即成交）
   - 验证仓位创建成功
   - 确认初始止盈止损状态

2. **仓位参数修改**
   - 根据测试场景执行相应修改操作
   - 验证修改请求提交成功
   - 确认修改操作及时生效

3. **修改结果验证**
   - 查询当前仓位，确认参数修改成功
   - 验证止盈止损价格设置正确
   - 确认风险度计算准确

4. **功能验证**
   - 验证修改后的止盈止损功能正常
   - 测试触发条件和执行逻辑
   - 确认参数约束和验证规则

5. **平仓验证**
   - 执行平仓操作
   - 验证平仓成功，仓位关闭
   - 确认历史记录包含修改信息

#### 5.2.6 预期结果
- ✅ 参数修改操作成功执行
- ✅ 止盈止损设置准确生效
- ✅ 风险控制机制正常工作
- ✅ 修改历史记录完整
- ✅ 触发逻辑符合预期

#### 5.2.7 测试用例清单

**全仓-做多 (Cross-Long)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 41_Trade_C_L_AddTP | 全仓做多_添加止盈参数 | Cross | Long | 添加TP |
| 42_Trade_C_L_AddSL | 全仓做多_添加止损参数 | Cross | Long | 添加SL |
| 43_Trade_C_L_AddTS | 全仓做多_添加止盈止损参数 | Cross | Long | 添加TS |
| 44_Trade_C_L_ModifyTP | 全仓做多_修改止盈价格 | Cross | Long | 修改TP |
| 45_Trade_C_L_ModifySL | 全仓做多_修改止损价格 | Cross | Long | 修改SL |
| 46_Trade_C_L_CancelTS | 全仓做多_取消止盈止损 | Cross | Long | 取消TS |

**全仓-做空 (Cross-Short)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 47_Trade_C_S_AddTP | 全仓做空_添加止盈参数 | Cross | Short | 添加TP |
| 48_Trade_C_S_AddSL | 全仓做空_添加止损参数 | Cross | Short | 添加SL |
| 49_Trade_C_S_AddTS | 全仓做空_添加止盈止损参数 | Cross | Short | 添加TS |
| 50_Trade_C_S_ModifyTP | 全仓做空_修改止盈价格 | Cross | Short | 修改TP |
| 51_Trade_C_S_ModifySL | 全仓做空_修改止损价格 | Cross | Short | 修改SL |
| 52_Trade_C_S_CancelTS | 全仓做空_取消止盈止损 | Cross | Short | 取消TS |

**逐仓-做多 (Isolated-Long)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 53_Trade_I_L_AddTP | 逐仓做多_添加止盈参数 | Isolated | Long | 添加TP |
| 54_Trade_I_L_AddSL | 逐仓做多_添加止损参数 | Isolated | Long | 添加SL |
| 55_Trade_I_L_AddTS | 逐仓做多_添加止盈止损参数 | Isolated | Long | 添加TS |
| 56_Trade_I_L_ModifyTP | 逐仓做多_修改止盈价格 | Isolated | Long | 修改TP |
| 57_Trade_I_L_ModifySL | 逐仓做多_修改止损价格 | Isolated | Long | 修改SL |
| 58_Trade_I_L_CancelTS | 逐仓做多_取消止盈止损 | Isolated | Long | 取消TS |

**逐仓-做空 (Isolated-Short)**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 59_Trade_I_S_AddTP | 逐仓做空_添加止盈参数 | Isolated | Short | 添加TP |
| 60_Trade_I_S_AddSL | 逐仓做空_添加止损参数 | Isolated | Short | 添加SL |
| 61_Trade_I_S_AddTS | 逐仓做空_添加止盈止损参数 | Isolated | Short | 添加TS |
| 62_Trade_I_S_ModifyTP | 逐仓做空_修改止盈价格 | Isolated | Short | 修改TP |
| 63_Trade_I_S_ModifySL | 逐仓做空_修改止损价格 | Isolated | Short | 修改SL |
| 64_Trade_I_S_CancelTS | 逐仓做空_取消止盈止损 | Isolated | Short | 取消TS |

**说明**:
- 场景2共包含24条测试用例（41-64号）
- 覆盖全仓/逐仓 × 做多/做空 × 6种修改类型的完整组合
- 每个用例都包含详细的前置条件、执行步骤和预期结果

---

## 6. P1优先级测试场景（重要功能）

### 场景10: 数据一致性场景 【P1优先级】

#### 6.10.1 场景概述
- **场景目标**: 验证交易系统中各模块间数据的一致性和准确性
- **业务重要性**: ⭐⭐⭐⭐ 数据准确性是系统可信度的基础
- **用例数量**: 12条用例
- **覆盖维度**: 数据类型(3) × 仓位模式(2) × 交易方向(2) = 12条

#### 6.10.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 数据类型 | 余额一致性、仓位一致性、盈亏一致性 | 3种核心数据类型 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |

#### 6.10.3 关联接口
- **主要接口**: 查询账户余额、查询当前持仓、查询盈亏明细、查询成交记录
- **辅助接口**: 下单接口、平仓接口、查询历史订单、查询资金流水

#### 6.10.4 测试流程
```
数据基准建立 → 交易操作执行 → 多接口数据查询 → 数据一致性验证 → 异常处理验证
```

#### 6.10.5 关键验证点
- ✅ 账户余额在各接口间保持一致
- ✅ 仓位信息在不同查询方式下一致
- ✅ 盈亏计算准确且实时更新
- ✅ 成交记录与仓位变化匹配
- ✅ 资金流水与余额变化对应
- ✅ 数据更新的实时性和完整性

#### 6.10.6 测试数据要求
- **交易对**: BTC/USDT
- **基础资金**: 10000 USDT
- **交易数量**: 0.1 BTC
- **价格范围**: 当前市价 ± 5%
- **验证精度**: 小数点后8位

#### 6.10.7 测试用例清单

**余额一致性验证**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 验证类型 |
| :--- | :--- | :--- | :--- | :--- |
| 65_Trade_C_L_BalanceCheck | 全仓做多_余额一致性验证 | Cross | Long | 余额一致性 |
| 66_Trade_C_S_BalanceCheck | 全仓做空_余额一致性验证 | Cross | Short | 余额一致性 |
| 67_Trade_I_L_BalanceCheck | 逐仓做多_余额一致性验证 | Isolated | Long | 余额一致性 |
| 68_Trade_I_S_BalanceCheck | 逐仓做空_余额一致性验证 | Isolated | Short | 余额一致性 |

**仓位一致性验证**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 验证类型 |
| :--- | :--- | :--- | :--- | :--- |
| 69_Trade_C_L_PositionCheck | 全仓做多_仓位一致性验证 | Cross | Long | 仓位一致性 |
| 70_Trade_C_S_PositionCheck | 全仓做空_仓位一致性验证 | Cross | Short | 仓位一致性 |
| 71_Trade_I_L_PositionCheck | 逐仓做多_仓位一致性验证 | Isolated | Long | 仓位一致性 |
| 72_Trade_I_S_PositionCheck | 逐仓做空_仓位一致性验证 | Isolated | Short | 仓位一致性 |

**盈亏一致性验证**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 验证类型 |
| :--- | :--- | :--- | :--- | :--- |
| 73_Trade_C_L_PnLCheck | 全仓做多_盈亏一致性验证 | Cross | Long | 盈亏一致性 |
| 74_Trade_C_S_PnLCheck | 全仓做空_盈亏一致性验证 | Cross | Short | 盈亏一致性 |
| 75_Trade_I_L_PnLCheck | 逐仓做多_盈亏一致性验证 | Isolated | Long | 盈亏一致性 |
| 76_Trade_I_S_PnLCheck | 逐仓做空_盈亏一致性验证 | Isolated | Short | 盈亏一致性 |

**说明**:
- 场景10共包含12条测试用例（65-76号）
- 覆盖数据类型(3) × 仓位模式(2) × 交易方向(2) = 12条
- 每个用例都包含多接口数据对比和一致性验证

#### 6.10.8 详细测试用例

##### 用例65: 全仓做多_余额一致性验证
- **用例编号**: 65_Trade_C_L_BalanceCheck
- **用例名称**: 全仓做多_余额一致性验证
- **所属场景**: 场景10 - 数据一致性场景
- **用例描述**: 验证全仓做多交易过程中，账户余额在不同接口查询结果的一致性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放

**测试步骤**:
1. 记录初始状态
   - 调用查询账户余额接口，记录USDT余额(balance_1)
   - 调用查询资金流水接口，记录最新余额(balance_2)
   - 调用查询当前持仓接口，记录可用保证金(margin_1)
2. 执行全仓做多开仓
   - 调用下单接口：市价买入0.1 BTC，全仓模式
   - 等待订单成交确认
3. 验证开仓后余额一致性
   - 调用查询账户余额接口，获取新余额(balance_3)
   - 调用查询资金流水接口，获取最新余额(balance_4)
   - 调用查询当前持仓接口，获取可用保证金(margin_2)
   - 调用查询成交记录接口，获取成交金额(trade_amount)
4. 执行平仓操作
   - 调用平仓接口：市价卖出0.1 BTC
   - 等待平仓完成确认
5. 验证平仓后余额一致性
   - 调用查询账户余额接口，获取最终余额(balance_5)
   - 调用查询资金流水接口，获取最终余额(balance_6)
   - 调用查询盈亏明细接口，获取本次盈亏(pnl)

**预期结果**:
1. 初始状态验证：balance_1 = balance_2 = margin_1
2. 开仓后验证：balance_3 = balance_4，且 balance_1 - balance_3 = trade_amount + 手续费
3. 平仓后验证：balance_5 = balance_6，且 balance_5 = balance_1 + pnl - 总手续费
4. 所有接口返回的余额数据精确一致（误差 < 0.00000001）
5. 资金流水记录完整，包含开仓、平仓、手续费记录

**关联接口**:
- 查询账户余额接口
- 查询资金流水接口
- 查询当前持仓接口
- 下单接口
- 平仓接口
- 查询成交记录接口
- 查询盈亏明细接口

##### 用例69: 全仓做多_仓位一致性验证
- **用例编号**: 69_Trade_C_L_PositionCheck
- **用例名称**: 全仓做多_仓位一致性验证
- **所属场景**: 场景10 - 数据一致性场景
- **用例描述**: 验证全仓做多交易过程中，仓位信息在不同接口查询结果的一致性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放
5. 当前无持仓

**测试步骤**:
1. 验证初始无仓位状态
   - 调用查询当前持仓接口，确认无BTC持仓
   - 调用查询历史持仓接口，确认无未结算持仓
2. 执行分批开仓操作
   - 第一次：市价买入0.05 BTC，全仓模式
   - 等待成交确认
   - 第二次：市价买入0.05 BTC，全仓模式
   - 等待成交确认
3. 验证仓位合并一致性
   - 调用查询当前持仓接口，获取持仓信息(position_1)
   - 调用查询成交记录接口，计算总持仓量(total_size)
   - 调用查询盈亏明细接口，获取持仓盈亏(unrealized_pnl)
4. 执行部分平仓
   - 市价卖出0.03 BTC
   - 等待平仓确认
5. 验证部分平仓后一致性
   - 调用查询当前持仓接口，获取剩余持仓(position_2)
   - 调用查询历史持仓接口，获取已平仓部分(closed_position)
   - 验证：position_2.size + closed_position.size = total_size

**预期结果**:
1. 初始状态：所有接口确认无持仓
2. 分批开仓后：position_1.size = 0.1 BTC，与成交记录总和一致
3. 持仓均价计算准确，反映两次开仓的加权平均价格
4. 未实现盈亏计算准确，基于当前市价和持仓均价
5. 部分平仓后：剩余持仓 = 0.07 BTC，数据在各接口间一致
6. 已实现盈亏和未实现盈亏分别计算准确

**关联接口**:
- 查询当前持仓接口
- 查询历史持仓接口
- 下单接口
- 平仓接口
- 查询成交记录接口
- 查询盈亏明细接口

##### 用例73: 全仓做多_盈亏一致性验证
- **用例编号**: 73_Trade_C_L_PnLCheck
- **用例名称**: 全仓做多_盈亏一致性验证
- **所属场景**: 场景10 - 数据一致性场景
- **用例描述**: 验证全仓做多交易过程中，盈亏计算在不同接口查询结果的一致性和准确性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放
5. 当前无持仓

**测试步骤**:
1. 记录初始状态
   - 调用查询账户余额接口，记录初始USDT余额(initial_balance)
   - 调用查询盈亏明细接口，确认无未结算盈亏
2. 执行开仓操作
   - 调用下单接口：市价买入0.1 BTC，全仓模式
   - 记录开仓价格(open_price)和手续费(open_fee)
   - 等待订单成交确认
3. 验证未实现盈亏计算
   - 等待价格波动（或模拟价格变化）
   - 调用查询当前持仓接口，获取未实现盈亏(unrealized_pnl_1)
   - 调用查询盈亏明细接口，获取未实现盈亏(unrealized_pnl_2)
   - 获取当前市价(current_price)
   - 手动计算预期盈亏：expected_pnl = (current_price - open_price) * 0.1
4. 执行平仓操作
   - 调用平仓接口：市价卖出0.1 BTC
   - 记录平仓价格(close_price)和手续费(close_fee)
   - 等待平仓完成确认
5. 验证已实现盈亏计算
   - 调用查询盈亏明细接口，获取已实现盈亏(realized_pnl)
   - 调用查询账户余额接口，获取最终余额(final_balance)
   - 手动计算预期盈亏：expected_realized_pnl = (close_price - open_price) * 0.1 - open_fee - close_fee
   - 验证余额变化：final_balance = initial_balance + expected_realized_pnl

**预期结果**:
1. 未实现盈亏验证：
   - unrealized_pnl_1 = unrealized_pnl_2（接口间一致）
   - |unrealized_pnl_1 - expected_pnl| < 0.01（计算准确）
2. 已实现盈亏验证：
   - realized_pnl = expected_realized_pnl（计算准确）
   - final_balance = initial_balance + realized_pnl（余额变化一致）
3. 盈亏明细记录完整：
   - 包含开仓、持仓期间、平仓的完整盈亏记录
   - 手续费单独记录且计算准确
4. 数据精度：所有盈亏计算精确到小数点后8位

**关联接口**:
- 查询账户余额接口
- 查询当前持仓接口
- 查询盈亏明细接口
- 下单接口
- 平仓接口
- 查询成交记录接口

**备注**: 其他用例（66-68, 70-72, 74-76）采用相似的测试逻辑，分别针对不同的仓位模式和交易方向进行验证，确保数据一致性在各种交易场景下都能得到保障。

### 场景9: 批量操作场景 【P1优先级】

#### 6.9.1 场景概述
- **场景目标**: 验证批量交易操作的功能性、性能和数据一致性
- **业务重要性**: ⭐⭐⭐⭐ 专业交易者的重要需求，提升操作效率
- **用例数量**: 16条用例
- **覆盖维度**: 操作类型(4) × 仓位模式(2) × 交易方向(2) = 16条

#### 6.9.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 操作类型 | 批量下单、批量撤单、批量修改、批量平仓 | 4种批量操作 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |

#### 6.9.3 关联接口
- **主要接口**: 批量下单接口、批量撤单接口、批量修改接口、批量平仓接口
- **辅助接口**: 查询当前委托、查询当前持仓、查询账户余额、查询成交记录

#### 6.9.4 测试流程
```
批量操作准备 → 执行批量操作 → 验证操作结果 → 检查数据一致性 → 性能指标验证
```

#### 6.9.5 关键验证点
- ✅ 批量操作的原子性和一致性
- ✅ 部分成功/失败的处理机制
- ✅ 操作性能满足业务要求
- ✅ 错误处理和回滚机制
- ✅ 并发操作的数据安全性
- ✅ 批量操作的限制和边界条件

#### 6.9.6 测试数据要求
- **交易对**: BTC/USDT
- **基础资金**: 50000 USDT（支持多笔交易）
- **批量数量**: 5-10笔操作
- **交易数量**: 每笔0.01-0.05 BTC
- **性能要求**: 批量操作响应时间 < 3秒

#### 6.9.7 测试用例清单

**批量下单操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 操作类型 |
| :--- | :--- | :--- | :--- | :--- |
| 77_Trade_C_L_BatchOrder | 全仓做多_批量下单操作 | Cross | Long | 批量下单 |
| 78_Trade_C_S_BatchOrder | 全仓做空_批量下单操作 | Cross | Short | 批量下单 |
| 79_Trade_I_L_BatchOrder | 逐仓做多_批量下单操作 | Isolated | Long | 批量下单 |
| 80_Trade_I_S_BatchOrder | 逐仓做空_批量下单操作 | Isolated | Short | 批量下单 |

**批量撤单操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 操作类型 |
| :--- | :--- | :--- | :--- | :--- |
| 81_Trade_C_L_BatchCancel | 全仓做多_批量撤单操作 | Cross | Long | 批量撤单 |
| 82_Trade_C_S_BatchCancel | 全仓做空_批量撤单操作 | Cross | Short | 批量撤单 |
| 83_Trade_I_L_BatchCancel | 逐仓做多_批量撤单操作 | Isolated | Long | 批量撤单 |
| 84_Trade_I_S_BatchCancel | 逐仓做空_批量撤单操作 | Isolated | Short | 批量撤单 |

**批量修改操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 操作类型 |
| :--- | :--- | :--- | :--- | :--- |
| 85_Trade_C_L_BatchModify | 全仓做多_批量修改操作 | Cross | Long | 批量修改 |
| 86_Trade_C_S_BatchModify | 全仓做空_批量修改操作 | Cross | Short | 批量修改 |
| 87_Trade_I_L_BatchModify | 逐仓做多_批量修改操作 | Isolated | Long | 批量修改 |
| 88_Trade_I_S_BatchModify | 逐仓做空_批量修改操作 | Isolated | Short | 批量修改 |

**批量平仓操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 操作类型 |
| :--- | :--- | :--- | :--- | :--- |
| 89_Trade_C_L_BatchClose | 全仓做多_批量平仓操作 | Cross | Long | 批量平仓 |
| 90_Trade_C_S_BatchClose | 全仓做空_批量平仓操作 | Cross | Short | 批量平仓 |
| 91_Trade_I_L_BatchClose | 逐仓做多_批量平仓操作 | Isolated | Long | 批量平仓 |
| 92_Trade_I_S_BatchClose | 逐仓做空_批量平仓操作 | Isolated | Short | 批量平仓 |

**说明**:
- 场景9共包含16条测试用例（77-92号）
- 覆盖操作类型(4) × 仓位模式(2) × 交易方向(2) = 16条
- 每个用例都包含性能验证和异常处理测试

#### 6.9.8 详细测试用例

##### 用例77: 全仓做多_批量下单操作
- **用例编号**: 77_Trade_C_L_BatchOrder
- **用例名称**: 全仓做多_批量下单操作
- **所属场景**: 场景9 - 批量操作场景
- **用例描述**: 验证全仓做多模式下批量下单操作的功能性、性能和数据一致性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 50000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放
5. 当前无持仓和挂单

**测试步骤**:
1. 准备批量下单数据
   - 准备5笔限价买单：价格分别为当前市价的95%, 96%, 97%, 98%, 99%
   - 每笔数量：0.02 BTC
   - 全部设置为全仓模式
2. 记录操作前状态
   - 调用查询账户余额接口，记录初始余额
   - 调用查询当前委托接口，确认无挂单
   - 记录操作开始时间
3. 执行批量下单操作
   - 调用批量下单接口，提交5笔订单
   - 记录接口响应时间
   - 获取批量操作结果
4. 验证批量下单结果
   - 调用查询当前委托接口，验证5笔订单状态
   - 验证订单信息：价格、数量、仓位模式、交易方向
   - 调用查询账户余额接口，验证保证金占用
5. 验证性能指标
   - 批量操作响应时间 < 3秒
   - 所有订单状态更新及时
6. 异常情况测试
   - 提交包含无效价格的批量订单
   - 验证部分成功/失败的处理机制

**预期结果**:
1. 批量下单操作成功，5笔订单全部创建
2. 订单信息准确：价格、数量、模式、方向符合预期
3. 账户余额正确扣减保证金
4. 性能指标满足要求：响应时间 < 3秒
5. 异常处理正确：无效订单被拒绝，有效订单正常创建
6. 操作具有原子性：要么全部成功，要么回滚

**关联接口**:
- 批量下单接口
- 查询当前委托接口
- 查询账户余额接口

##### 用例81: 全仓做多_批量撤单操作
- **用例编号**: 81_Trade_C_L_BatchCancel
- **用例名称**: 全仓做多_批量撤单操作
- **所属场景**: 场景9 - 批量操作场景
- **用例描述**: 验证全仓做多模式下批量撤单操作的功能性和性能
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 50000
3. 系统处于正常交易时间
4. 已有5笔全仓做多限价挂单

**测试步骤**:
1. 准备批量撤单数据
   - 调用查询当前委托接口，获取5笔挂单ID
   - 记录撤单前的订单状态和余额
2. 执行批量撤单操作
   - 调用批量撤单接口，提交5笔订单的撤单请求
   - 记录接口响应时间
   - 获取批量撤单结果
3. 验证批量撤单结果
   - 调用查询当前委托接口，确认订单已撤销
   - 调用查询账户余额接口，验证保证金释放
   - 调用查询历史订单接口，确认撤单记录
4. 验证性能指标
   - 批量撤单响应时间 < 2秒
   - 保证金释放及时
5. 异常情况测试
   - 尝试撤销已成交的订单
   - 尝试撤销不存在的订单ID

**预期结果**:
1. 批量撤单操作成功，5笔订单全部撤销
2. 账户余额正确释放保证金
3. 历史记录完整记录撤单操作
4. 性能指标满足要求：响应时间 < 2秒
5. 异常处理正确：无效撤单请求被拒绝

**关联接口**:
- 批量撤单接口
- 查询当前委托接口
- 查询账户余额接口
- 查询历史订单接口

##### 用例89: 全仓做多_批量平仓操作
- **用例编号**: 89_Trade_C_L_BatchClose
- **用例名称**: 全仓做多_批量平仓操作
- **所属场景**: 场景9 - 批量操作场景
- **用例描述**: 验证全仓做多模式下批量平仓操作的功能性、性能和风险控制
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户有5个不同的全仓做多持仓
3. 每个持仓数量：0.02 BTC
4. 系统处于正常交易时间
5. 市场流动性充足

**测试步骤**:
1. 准备批量平仓数据
   - 调用查询当前持仓接口，获取5个持仓信息
   - 记录平仓前的持仓状态、余额和盈亏
   - 准备平仓参数：全部市价平仓
2. 执行批量平仓操作
   - 调用批量平仓接口，提交5个持仓的平仓请求
   - 记录接口响应时间
   - 获取批量平仓结果
3. 验证批量平仓结果
   - 调用查询当前持仓接口，确认持仓已平仓
   - 调用查询账户余额接口，验证资金变化
   - 调用查询成交记录接口，确认平仓成交
   - 调用查询盈亏明细接口，验证盈亏计算
4. 验证性能指标
   - 批量平仓响应时间 < 5秒
   - 所有持仓同时平仓完成
5. 风险控制验证
   - 验证平仓价格的合理性
   - 验证滑点控制机制
6. 异常情况测试
   - 尝试平仓不存在的持仓
   - 在市场流动性不足时执行批量平仓

**预期结果**:
1. 批量平仓操作成功，5个持仓全部平仓
2. 账户余额正确反映平仓后的资金状态
3. 盈亏计算准确，包含手续费
4. 性能指标满足要求：响应时间 < 5秒
5. 风险控制有效：滑点在可接受范围内
6. 异常处理正确：无效平仓请求被拒绝
7. 成交记录完整，可追溯

**关联接口**:
- 批量平仓接口
- 查询当前持仓接口
- 查询账户余额接口
- 查询成交记录接口
- 查询盈亏明细接口

**备注**: 其他用例（78-80, 82-88, 90-92）采用相似的测试逻辑，分别针对不同的操作类型、仓位模式和交易方向进行验证，确保批量操作在各种场景下都能稳定高效地执行。

### 场景5: 订单修改与撤单 【P1优先级】

#### 6.5.1 场景概述
- **场景目标**: 验证单个订单的修改和撤单功能的准确性和实时性
- **业务重要性**: ⭐⭐⭐⭐ 灵活的订单管理是交易系统的基础功能
- **用例数量**: 12条用例
- **覆盖维度**: 修改类型(3) × 仓位模式(2) × 交易方向(2) = 12条

#### 6.5.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 修改类型 | 价格修改、数量修改、止盈止损修改 | 3种主要修改操作 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |

#### 6.5.3 关联接口
- **主要接口**: 修改订单接口、撤单接口、查询当前委托、查询历史订单
- **辅助接口**: 下单接口、查询账户余额、查询成交记录

#### 6.5.4 测试流程
```
创建测试订单 → 执行修改操作 → 验证修改结果 → 执行撤单操作 → 验证撤单结果
```

#### 6.5.5 关键验证点
- ✅ 订单修改的实时性和准确性
- ✅ 修改操作的业务规则验证
- ✅ 撤单操作的及时性和完整性
- ✅ 保证金和余额的正确调整
- ✅ 修改和撤单的历史记录
- ✅ 并发修改的数据一致性

#### 6.5.6 测试数据要求
- **交易对**: BTC/USDT
- **基础资金**: 10000 USDT
- **订单数量**: 0.1 BTC
- **价格范围**: 当前市价 ± 10%
- **响应时间**: 修改/撤单操作 < 1秒

#### 6.5.7 测试用例清单

**价格修改操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 93_Trade_C_L_ModifyPrice | 全仓做多_订单价格修改 | Cross | Long | 价格修改 |
| 94_Trade_C_S_ModifyPrice | 全仓做空_订单价格修改 | Cross | Short | 价格修改 |
| 95_Trade_I_L_ModifyPrice | 逐仓做多_订单价格修改 | Isolated | Long | 价格修改 |
| 96_Trade_I_S_ModifyPrice | 逐仓做空_订单价格修改 | Isolated | Short | 价格修改 |

**数量修改操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 97_Trade_C_L_ModifySize | 全仓做多_订单数量修改 | Cross | Long | 数量修改 |
| 98_Trade_C_S_ModifySize | 全仓做空_订单数量修改 | Cross | Short | 数量修改 |
| 99_Trade_I_L_ModifySize | 逐仓做多_订单数量修改 | Isolated | Long | 数量修改 |
| 100_Trade_I_S_ModifySize | 逐仓做空_订单数量修改 | Isolated | Short | 数量修改 |

**止盈止损修改操作**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 修改类型 |
| :--- | :--- | :--- | :--- | :--- |
| 101_Trade_C_L_ModifyTPSL | 全仓做多_止盈止损修改 | Cross | Long | 止盈止损修改 |
| 102_Trade_C_S_ModifyTPSL | 全仓做空_止盈止损修改 | Cross | Short | 止盈止损修改 |
| 103_Trade_I_L_ModifyTPSL | 逐仓做多_止盈止损修改 | Isolated | Long | 止盈止损修改 |
| 104_Trade_I_S_ModifyTPSL | 逐仓做空_止盈止损修改 | Isolated | Short | 止盈止损修改 |

**说明**:
- 场景5共包含12条测试用例（93-104号）
- 覆盖修改类型(3) × 仓位模式(2) × 交易方向(2) = 12条
- 每个用例都包含修改和撤单的完整流程验证

#### 6.5.8 详细测试用例

##### 用例93: 全仓做多_订单价格修改
- **用例编号**: 93_Trade_C_L_ModifyPrice
- **用例名称**: 全仓做多_订单价格修改
- **所属场景**: 场景5 - 订单修改与撤单
- **用例描述**: 验证全仓做多限价订单的价格修改功能和业务规则
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放

**测试步骤**:
1. 创建测试订单
   - 调用下单接口：限价买入0.1 BTC，价格为当前市价的95%
   - 记录订单ID、原始价格、数量、保证金占用
   - 确认订单创建成功，状态为挂单
2. 执行价格修改操作
   - 调用修改订单接口：将价格修改为当前市价的98%
   - 记录修改操作时间和响应
   - 获取修改结果确认
3. 验证价格修改结果
   - 调用查询当前委托接口，确认价格已更新
   - 调用查询账户余额接口，验证保证金调整
   - 验证订单其他信息保持不变（数量、模式、方向）
4. 测试修改限制
   - 尝试修改为无效价格（负数、超出限制）
   - 尝试修改为市价以上的买单价格
   - 验证业务规则的正确性
5. 执行撤单操作
   - 调用撤单接口，撤销修改后的订单
   - 验证撤单成功，保证金释放
6. 验证历史记录
   - 调用查询历史订单接口，确认修改和撤单记录

**预期结果**:
1. 价格修改操作成功，响应时间 < 1秒
2. 订单价格正确更新为新价格
3. 保证金根据新价格正确调整
4. 无效修改被正确拒绝，返回明确错误信息
5. 撤单操作成功，保证金完全释放
6. 历史记录完整记录所有操作

**关联接口**:
- 下单接口
- 修改订单接口
- 撤单接口
- 查询当前委托接口
- 查询账户余额接口
- 查询历史订单接口

##### 用例97: 全仓做多_订单数量修改
- **用例编号**: 97_Trade_C_L_ModifySize
- **用例名称**: 全仓做多_订单数量修改
- **所属场景**: 场景5 - 订单修改与撤单
- **用例描述**: 验证全仓做多限价订单的数量修改功能和保证金计算
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放

**测试步骤**:
1. 创建测试订单
   - 调用下单接口：限价买入0.1 BTC，价格为当前市价的95%
   - 记录订单ID、原始数量、保证金占用
2. 执行数量增加修改
   - 调用修改订单接口：将数量从0.1 BTC增加到0.15 BTC
   - 验证账户余额是否足够支持增加的保证金
   - 确认修改操作成功
3. 验证数量增加结果
   - 调用查询当前委托接口，确认数量已更新
   - 调用查询账户余额接口，验证保证金增加
   - 计算保证金变化是否正确
4. 执行数量减少修改
   - 调用修改订单接口：将数量从0.15 BTC减少到0.08 BTC
   - 确认修改操作成功
5. 验证数量减少结果
   - 确认订单数量正确更新
   - 验证多余保证金正确释放
6. 测试边界条件
   - 尝试修改为0数量（应被拒绝）
   - 尝试修改为超出余额支持的数量
   - 尝试修改为低于最小交易数量
7. 执行撤单并验证

**预期结果**:
1. 数量修改操作成功，响应时间 < 1秒
2. 保证金根据数量变化正确调整
3. 边界条件正确处理，无效修改被拒绝
4. 撤单后保证金完全释放

**关联接口**:
- 下单接口
- 修改订单接口
- 撤单接口
- 查询当前委托接口
- 查询账户余额接口

##### 用例101: 全仓做多_止盈止损修改
- **用例编号**: 101_Trade_C_L_ModifyTPSL
- **用例名称**: 全仓做多_止盈止损修改
- **所属场景**: 场景5 - 订单修改与撤单
- **用例描述**: 验证全仓做多订单的止盈止损参数修改功能和风险控制
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 10000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放

**测试步骤**:
1. 创建带止盈止损的测试订单
   - 调用下单接口：限价买入0.1 BTC，价格为当前市价的95%
   - 设置止盈价格为当前市价的110%
   - 设置止损价格为当前市价的85%
   - 记录订单ID和原始止盈止损参数
2. 修改止盈价格
   - 调用修改订单接口：将止盈价格修改为当前市价的115%
   - 验证修改操作成功
   - 确认止盈价格更新，止损价格保持不变
3. 修改止损价格
   - 调用修改订单接口：将止损价格修改为当前市价的80%
   - 验证修改操作成功
   - 确认止损价格更新，止盈价格保持不变
4. 同时修改止盈止损
   - 调用修改订单接口：同时修改止盈和止损价格
   - 止盈价格：当前市价的120%
   - 止损价格：当前市价的75%
   - 验证两个参数都正确更新
5. 测试业务规则验证
   - 尝试设置无效的止盈价格（低于开仓价格）
   - 尝试设置无效的止损价格（高于开仓价格）
   - 验证系统正确拒绝无效设置
6. 取消止盈止损设置
   - 调用修改订单接口：移除止盈止损设置
   - 验证订单变为无止盈止损状态
7. 重新添加止盈止损
   - 为无止盈止损的订单添加止盈止损设置
   - 验证添加操作成功
8. 执行撤单并验证历史记录

**预期结果**:
1. 所有止盈止损修改操作成功，响应时间 < 1秒
2. 止盈止损参数正确更新，其他订单信息保持不变
3. 业务规则验证有效，无效设置被正确拒绝
4. 止盈止损的添加和移除功能正常
5. 历史记录完整记录所有修改操作
6. 撤单操作成功，无遗留数据

**关联接口**:
- 下单接口
- 修改订单接口
- 撤单接口
- 查询当前委托接口
- 查询历史订单接口

**备注**: 其他用例（94-96, 98-100, 102-104）采用相似的测试逻辑，分别针对不同的修改类型、仓位模式和交易方向进行验证，确保订单修改功能在各种场景下都能准确可靠地执行。特别注意做空订单的止盈止损逻辑与做多相反。

### 场景11: 权限与安全场景 【P1优先级】

#### 6.11.1 场景概述
- **场景目标**: 验证交易系统的权限控制和安全机制的有效性
- **业务重要性**: ⭐⭐⭐⭐⭐ 系统安全是交易平台的生命线
- **用例数量**: 8条用例
- **覆盖维度**: 安全类型(4) × 仓位模式(2) = 8条

#### 6.11.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 安全类型 | 账户权限、操作限制、风险控制、数据安全 | 4种安全验证 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |

#### 6.11.3 关联接口
- **主要接口**: 身份验证接口、权限验证接口、风险控制接口、操作日志接口
- **辅助接口**: 下单接口、查询接口、账户管理接口

#### 6.11.4 测试流程
```
权限验证 → 安全检查 → 操作执行 → 风险控制 → 日志记录 → 安全审计
```

#### 6.11.5 关键验证点
- ✅ 身份认证和授权机制
- ✅ 操作权限的精确控制
- ✅ 风险限制的实时监控
- ✅ 异常操作的检测和阻止
- ✅ 安全日志的完整记录
- ✅ 数据访问的权限控制

#### 6.11.6 测试数据要求
- **测试账户**: 多种权限级别的账户
- **基础资金**: 10000 USDT
- **交易数量**: 0.1 BTC
- **安全阈值**: 根据系统配置设定
- **监控时间**: 实时监控和记录

#### 6.11.7 测试用例清单

**账户权限验证**

| 用例编号 | 用例名称 | 仓位模式 | 安全类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 105_Trade_C_AuthCheck | 全仓模式_账户权限验证 | Cross | 账户权限 | 身份认证和授权 |
| 106_Trade_I_AuthCheck | 逐仓模式_账户权限验证 | Isolated | 账户权限 | 身份认证和授权 |

**操作限制控制**

| 用例编号 | 用例名称 | 仓位模式 | 安全类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 107_Trade_C_OpLimit | 全仓模式_操作限制控制 | Cross | 操作限制 | 频率和数量限制 |
| 108_Trade_I_OpLimit | 逐仓模式_操作限制控制 | Isolated | 操作限制 | 频率和数量限制 |

**风险控制机制**

| 用例编号 | 用例名称 | 仓位模式 | 安全类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 109_Trade_C_RiskControl | 全仓模式_风险控制机制 | Cross | 风险控制 | 风险阈值和强平 |
| 110_Trade_I_RiskControl | 逐仓模式_风险控制机制 | Isolated | 风险控制 | 风险阈值和强平 |

**数据安全保护**

| 用例编号 | 用例名称 | 仓位模式 | 安全类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 111_Trade_C_DataSecurity | 全仓模式_数据安全保护 | Cross | 数据安全 | 数据加密和访问控制 |
| 112_Trade_I_DataSecurity | 逐仓模式_数据安全保护 | Isolated | 数据安全 | 数据加密和访问控制 |

**说明**:
- 场景11共包含8条测试用例（105-112号）
- 覆盖安全类型(4) × 仓位模式(2) = 8条
- 每个用例都包含完整的安全验证和风险控制测试

#### 6.11.8 详细测试用例

##### 用例105: 全仓模式_账户权限验证
- **用例编号**: 105_Trade_C_AuthCheck
- **用例名称**: 全仓模式_账户权限验证
- **所属场景**: 场景11 - 权限与安全场景
- **用例描述**: 验证全仓模式下账户身份认证和操作授权的安全机制
- **优先级**: P1

**前置条件**:
1. 准备多种权限级别的测试账户
2. 系统安全配置正常
3. 身份认证服务正常运行

**测试步骤**:
1. 未认证账户访问测试
   - 使用未登录状态访问交易接口
   - 验证系统拒绝访问并返回认证错误
2. 无效token测试
   - 使用过期或无效的认证token
   - 验证系统正确识别并拒绝访问
3. 权限不足测试
   - 使用受限权限账户尝试执行超权限操作
   - 验证系统正确阻止并记录尝试
4. 正常权限验证
   - 使用正常权限账户执行全仓交易
   - 验证操作成功执行
5. 权限变更测试
   - 在交易过程中修改账户权限
   - 验证系统实时生效权限变更
6. 安全日志验证
   - 检查所有权限验证操作的日志记录
   - 验证日志完整性和准确性

**预期结果**:
1. 未认证访问被正确拒绝
2. 无效token被及时识别和阻止
3. 权限不足操作被准确拦截
4. 正常权限操作顺利执行
5. 权限变更实时生效
6. 安全日志完整记录所有操作

**关联接口**:
- 身份验证接口
- 权限验证接口
- 下单接口
- 操作日志接口

##### 用例109: 全仓模式_风险控制机制
- **用例编号**: 109_Trade_C_RiskControl
- **用例名称**: 全仓模式_风险控制机制
- **所属场景**: 场景11 - 权限与安全场景
- **用例描述**: 验证全仓模式下风险控制机制的有效性和实时性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证
2. 账户USDT余额 = 1000（较小余额用于触发风险控制）
3. 系统风险控制参数已配置
4. 市场价格波动正常

**测试步骤**:
1. 正常风险水平测试
   - 执行小额全仓交易，保持安全的风险水平
   - 验证系统正常执行交易
2. 接近风险阈值测试
   - 逐步增加仓位，接近风险警告线
   - 验证系统发出风险警告
3. 超过风险阈值测试
   - 尝试执行超过风险承受能力的交易
   - 验证系统拒绝交易并提示风险过高
4. 强平触发测试
   - 模拟市场不利变动，触发强平条件
   - 验证系统自动执行强平操作
5. 风险控制恢复测试
   - 在强平后，验证账户风险水平恢复
   - 测试恢复后的正常交易功能
6. 风险监控实时性测试
   - 验证风险指标的实时更新
   - 测试风险控制的响应速度

**预期结果**:
1. 正常风险水平下交易顺利执行
2. 风险警告及时准确发出
3. 超风险交易被正确拒绝
4. 强平机制及时有效触发
5. 强平后账户状态正确恢复
6. 风险监控实时性满足要求（< 1秒）

**关联接口**:
- 风险控制接口
- 下单接口
- 强平接口
- 查询账户余额接口
- 查询当前持仓接口

**备注**: 其他用例（106, 107-108, 110-112）采用相似的测试逻辑，分别针对不同的安全类型和仓位模式进行验证，确保系统安全机制在各种场景下都能有效防护。

### 场景3: 仓位自动合并 【P1优先级】

#### 6.3.1 场景概述
- **场景目标**: 验证同方向仓位自动合并功能的准确性和数据一致性
- **业务重要性**: ⭐⭐⭐⭐ 核心仓位管理功能，确保仓位数据准确性
- **用例数量**: 4条用例
- **覆盖维度**: 仓位模式(2) × 交易方向(2) = 4条

#### 6.3.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |
| 交易方向 | Long(L), Short(S) | 做多、做空 |

#### 6.3.3 关联接口
- **主要接口**: 下单接口、查询当前持仓、查询历史持仓
- **辅助接口**: 平仓接口、查询账户余额、查询盈亏明细、查询成交记录

#### 6.3.4 测试流程
```
首次开仓 → 二次开仓(同方向) → 验证自动合并 → 检查均价计算 → 验证数据一致性
```

#### 6.3.5 关键验证点
- ✅ 同方向仓位自动合并功能
- ✅ 合并后均价计算准确性
- ✅ 仓位数量累加正确性
- ✅ 保证金和盈亏的重新计算
- ✅ 止盈止损参数的合并逻辑
- ✅ 成交记录的完整性

#### 6.3.6 测试数据要求
- **交易对**: BTC/USDT
- **基础资金**: 20000 USDT
- **首次开仓**: 0.1 BTC
- **二次开仓**: 0.1 BTC
- **价格差异**: 不同价格建仓以测试均价计算
- **计算精度**: 小数点后8位

#### 6.3.7 测试用例清单

**仓位自动合并验证**

| 用例编号 | 用例名称 | 仓位模式 | 交易方向 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 113_Trade_C_L_AutoMerge | 全仓做多_仓位自动合并 | Cross | Long | 自动合并和均价计算 |
| 114_Trade_C_S_AutoMerge | 全仓做空_仓位自动合并 | Cross | Short | 自动合并和均价计算 |
| 115_Trade_I_L_AutoMerge | 逐仓做多_仓位自动合并 | Isolated | Long | 自动合并和均价计算 |
| 116_Trade_I_S_AutoMerge | 逐仓做空_仓位自动合并 | Isolated | Short | 自动合并和均价计算 |

**说明**:
- 场景3共包含4条测试用例（113-116号）
- 覆盖仓位模式(2) × 交易方向(2) = 4条
- 每个用例都验证自动合并功能和均价计算准确性

#### 6.3.8 详细测试用例

##### 用例113: 全仓做多_仓位自动合并
- **用例编号**: 113_Trade_C_L_AutoMerge
- **用例名称**: 全仓做多_仓位自动合并
- **所属场景**: 场景3 - 仓位自动合并
- **用例描述**: 验证全仓做多模式下同方向仓位自动合并的均价计算和数据一致性
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 20000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放
5. 当前无持仓

**测试步骤**:
1. 首次开仓操作
   - 调用下单接口：市价买入0.1 BTC，全仓模式
   - 记录成交价格P1和成交时间
   - 调用查询当前持仓接口，确认创建了一个仓位
   - 记录仓位信息：数量0.1 BTC，均价P1
2. 等待价格变化
   - 等待市场价格发生变化（或手动调整测试价格）
   - 记录当前市价P2，确保P2 ≠ P1
3. 二次开仓操作（同方向）
   - 调用下单接口：市价买入0.1 BTC，全仓模式
   - 记录成交价格P2和成交时间
   - 立即调用查询当前持仓接口
4. 验证自动合并结果
   - 确认仍然只有一个全仓做多仓位（自动合并）
   - 验证合并后仓位数量：0.2 BTC
   - 验证合并后均价：(P1*0.1 + P2*0.1) / 0.2
   - 验证未实现盈亏基于新均价计算
5. 验证保证金计算
   - 调用查询账户余额接口，确认保证金正确调整
   - 验证保证金 = 0.2 BTC * 均价 / 杠杆倍数
6. 验证成交记录
   - 调用查询成交记录接口，确认两次成交记录都存在
   - 验证成交记录的完整性和准确性
7. 三次开仓验证
   - 再次执行市价买入0.1 BTC
   - 验证仓位继续自动合并为0.3 BTC
   - 验证均价重新计算的准确性

**预期结果**:
1. 同方向开仓自动合并到同一个仓位
2. 合并后仓位数量正确累加：0.1 → 0.2 → 0.3 BTC
3. 均价计算准确：加权平均价格，误差 < 0.01 USDT
4. 未实现盈亏基于新均价正确计算
5. 保证金根据总仓位数量正确调整
6. 成交记录完整保留，可追溯每次交易
7. 自动合并过程无需手动操作，实时生效

**关联接口**:
- 下单接口
- 查询当前持仓接口
- 查询账户余额接口
- 查询成交记录接口
- 查询盈亏明细接口

##### 用例115: 逐仓做多_仓位自动合并
- **用例编号**: 115_Trade_I_L_AutoMerge
- **用例名称**: 逐仓做多_仓位自动合并
- **所属场景**: 场景3 - 仓位自动合并
- **用例描述**: 验证逐仓做多模式下同方向仓位自动合并的均价计算和保证金管理
- **优先级**: P1

**前置条件**:
1. 账户已完成实名认证，状态正常
2. 账户USDT余额 ≥ 20000
3. 系统处于正常交易时间
4. BTC/USDT交易对正常开放
5. 当前无持仓

**测试步骤**:
1. 首次逐仓开仓
   - 调用下单接口：市价买入0.1 BTC，逐仓模式，保证金1000 USDT
   - 记录成交价格P1和分配的保证金
   - 调用查询当前持仓接口，确认创建了一个逐仓仓位
2. 二次逐仓开仓（同方向）
   - 调用下单接口：市价买入0.1 BTC，逐仓模式，保证金1500 USDT
   - 记录成交价格P2和新增保证金
   - 验证系统自动合并到同一个逐仓仓位
3. 验证逐仓合并结果
   - 确认仍然只有一个逐仓做多仓位
   - 验证合并后仓位数量：0.2 BTC
   - 验证合并后均价：(P1*0.1 + P2*0.1) / 0.2
   - 验证合并后保证金：1000 + 1500 = 2500 USDT
4. 验证逐仓风险计算
   - 验证逐仓保证金率 = 2500 / (0.2 * 均价)
   - 验证逐仓强平价格基于总保证金计算
   - 验证未实现盈亏基于新均价计算
5. 测试逐仓保证金调整
   - 调用调整保证金接口，增加500 USDT保证金
   - 验证总保证金变为3000 USDT
   - 验证强平价格相应调整
6. 验证逐仓独立性
   - 确认该逐仓仓位与其他交易对的仓位完全独立
   - 验证保证金和风险计算的独立性

**预期结果**:
1. 逐仓同方向开仓自动合并到同一个仓位
2. 合并后仓位数量正确：0.2 BTC
3. 均价计算准确：加权平均价格
4. 保证金正确累加：2500 USDT
5. 逐仓风险指标基于总保证金正确计算
6. 保证金调整功能正常，强平价格实时更新
7. 逐仓仓位保持独立性，不影响其他仓位

**关联接口**:
- 下单接口
- 查询当前持仓接口
- 查询账户余额接口
- 调整保证金接口
- 查询成交记录接口

**备注**: 其他用例（114, 116）采用相似的测试逻辑，分别针对不同的仓位模式和交易方向进行验证。特别注意做空仓位的盈亏计算逻辑与做多相反，以及逐仓模式下保证金的独立管理。

---

## 7. P2优先级测试场景（辅助功能）

### 场景7: 历史数据场景 【P2优先级】

#### 7.7.1 场景概述
- **场景目标**: 验证历史数据查询和统计功能的完整性和准确性
- **业务重要性**: ⭐⭐⭐ 数据分析和审计的重要支撑
- **用例数量**: 8条用例
- **覆盖维度**: 数据类型(4) × 仓位模式(2) = 8条

#### 7.7.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 数据类型 | 历史订单、历史持仓、历史成交、历史盈亏 | 4种历史数据类型 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |

#### 7.7.3 关联接口
- **主要接口**: 查询历史订单接口、查询历史持仓接口、查询历史成交接口、查询历史盈亏接口
- **辅助接口**: 下单接口、平仓接口、查询当前持仓

#### 7.7.4 测试流程
```
创建历史数据 → 执行基础查询 → 验证数据完整性 → 检查数据准确性 → 验证查询性能
```

#### 7.7.5 关键验证点
- ✅ 历史数据的完整性和准确性
- ✅ 查询功能的基础可用性
- ✅ 返回数据的格式正确性
- ✅ 数据内容的准确性验证
- ✅ 查询响应的稳定性
- ✅ 基础性能要求满足

#### 7.7.6 测试数据要求
- **交易对**: BTC/USDT
- **历史周期**: 最近7天
- **数据量**: 至少10条记录
- **数据类型**: 订单、持仓、成交、盈亏记录
- **性能要求**: 查询响应时间 < 3秒

#### 7.7.7 测试用例清单

**历史订单查询**

| 用例编号 | 用例名称 | 仓位模式 | 数据类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 117_Trade_C_HistoryOrder | 全仓模式_历史订单查询 | Cross | 历史订单 | 基础查询和数据准确性 |
| 118_Trade_I_HistoryOrder | 逐仓模式_历史订单查询 | Isolated | 历史订单 | 基础查询和数据准确性 |

**历史持仓查询**

| 用例编号 | 用例名称 | 仓位模式 | 数据类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 119_Trade_C_HistoryPosition | 全仓模式_历史持仓查询 | Cross | 历史持仓 | 基础查询和数据准确性 |
| 120_Trade_I_HistoryPosition | 逐仓模式_历史持仓查询 | Isolated | 历史持仓 | 基础查询和数据准确性 |

**历史成交查询**

| 用例编号 | 用例名称 | 仓位模式 | 数据类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 121_Trade_C_HistoryTrade | 全仓模式_历史成交查询 | Cross | 历史成交 | 基础查询和数据准确性 |
| 122_Trade_I_HistoryTrade | 逐仓模式_历史成交查询 | Isolated | 历史成交 | 基础查询和数据准确性 |

**历史盈亏查询**

| 用例编号 | 用例名称 | 仓位模式 | 数据类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 123_Trade_C_HistoryPnL | 全仓模式_历史盈亏查询 | Cross | 历史盈亏 | 基础查询和数据准确性 |
| 124_Trade_I_HistoryPnL | 逐仓模式_历史盈亏查询 | Isolated | 历史盈亏 | 基础查询和数据准确性 |

**说明**:
- 场景7共包含8条测试用例（117-124号）
- 覆盖数据类型(4) × 仓位模式(2) = 8条
- 每个用例都验证基础查询功能、数据完整性和准确性

#### 7.7.8 详细测试用例

##### 用例117: 全仓模式_历史订单查询
- **用例编号**: 117_Trade_C_HistoryOrder
- **用例名称**: 全仓模式_历史订单查询
- **所属场景**: 场景7 - 历史数据场景
- **用例描述**: 验证全仓模式下历史订单查询功能的基本可用性和数据准确性
- **优先级**: P2

**前置条件**:
1. 账户已有一些历史交易记录
2. 系统正常运行，历史数据查询服务可用
3. 具有查询历史数据的权限

**测试步骤**:
1. 基础查询测试
   - 调用查询历史订单接口，查询全仓模式的历史订单
   - 验证接口能够正常返回数据
   - 检查返回数据的基本格式和结构
2. 数据完整性验证
   - 验证返回的订单记录包含必要字段：订单ID、价格、数量、状态、时间等
   - 检查字段数据类型和格式的正确性
   - 确认时间戳格式符合系统标准
3. 数据准确性验证
   - 对比历史订单数据与实际交易记录
   - 验证订单状态、价格、数量等关键信息的准确性
   - 确认历史数据与当时的交易操作一致
4. 查询稳定性测试
   - 多次调用查询接口，验证结果的一致性
   - 测试在不同时间点查询的稳定性
   - 验证接口的可靠性和稳定性
5. 性能测试
   - 验证查询响应时间在可接受范围内（< 3秒）
   - 测试接口的基本性能表现

**预期结果**:
1. 查询接口正常响应，能够返回历史订单数据
2. 返回数据格式正确，包含所有必要字段
3. 数据内容准确，与实际交易记录一致
4. 查询结果稳定，多次查询结果一致
5. 查询性能满足要求，响应时间 < 3秒
6. 接口运行稳定，无异常错误

**关联接口**:
- 查询历史订单接口

##### 用例123: 全仓模式_历史盈亏查询
- **用例编号**: 123_Trade_C_HistoryPnL
- **用例名称**: 全仓模式_历史盈亏查询
- **所属场景**: 场景7 - 历史数据场景
- **用例描述**: 验证全仓模式下历史盈亏查询功能的基本可用性和数据准确性
- **优先级**: P2

**前置条件**:
1. 账户已有一些历史交易和盈亏记录
2. 系统正常运行，历史数据查询服务可用
3. 具有查询历史盈亏数据的权限

**测试步骤**:
1. 基础盈亏查询
   - 调用查询历史盈亏接口，查询全仓模式的历史盈亏记录
   - 验证接口能够正常返回盈亏数据
   - 检查返回数据的基本格式和结构
2. 数据完整性验证
   - 验证返回的盈亏记录包含必要字段：交易ID、盈亏金额、手续费、时间等
   - 检查字段数据类型和数值格式的正确性
   - 确认盈亏金额的计算逻辑正确
3. 数据准确性验证
   - 对比历史盈亏数据与实际交易结果
   - 验证盈亏金额计算的准确性
   - 检查手续费扣除的正确性
4. 查询稳定性测试
   - 多次调用查询接口，验证结果的一致性
   - 测试接口的可靠性和稳定性
5. 数据一致性验证
   - 验证历史盈亏数据与账户资金变化的逻辑一致性
   - 确认盈亏记录的完整性

**预期结果**:
1. 查询接口正常响应，能够返回历史盈亏数据
2. 返回数据格式正确，包含所有必要字段
3. 盈亏计算准确，数据逻辑正确
4. 查询结果稳定，多次查询结果一致
5. 查询性能满足要求，响应时间 < 3秒
6. 数据一致性验证通过，逻辑合理

**关联接口**:
- 查询历史盈亏接口
- 查询账户余额接口
- 查询资金流水接口

**备注**: 其他用例（118-122, 124）采用相似的简化测试逻辑，分别针对不同的数据类型（历史持仓、历史成交）和仓位模式进行基础查询验证，确保历史数据查询功能的基本可用性和数据准确性。重点验证查询功能可用、数据完整、内容准确。

### 场景8: 系统配置场景 【P2优先级】

#### 7.8.1 场景概述
- **场景目标**: 验证交易系统配置参数的查询和管理功能
- **业务重要性**: ⭐⭐⭐ 系统运维和参数管理的重要工具
- **用例数量**: 6条用例
- **覆盖维度**: 配置类型(3) × 仓位模式(2) = 6条

#### 7.8.2 测试维度组合
| 维度 | 选项 | 说明 |
|------|------|------|
| 配置类型 | 交易参数、风险参数、系统参数 | 3种配置类型 |
| 仓位模式 | Cross(C), Isolated(I) | 全仓、逐仓 |

#### 7.8.3 关联接口
- **主要接口**: 查询交易配置接口、查询风险配置接口、查询系统参数接口
- **辅助接口**: 查询交易对信息、查询手续费配置、查询杠杆配置

#### 7.8.4 测试流程
```
查询配置参数 → 验证参数有效性 → 测试参数应用 → 检查配置一致性 → 验证查询性能
```

#### 7.8.5 关键验证点
- ✅ 配置参数的完整性和准确性
- ✅ 参数格式和数值范围的正确性
- ✅ 配置参数的实时获取性
- ✅ 不同模式下参数的差异化
- ✅ 配置查询的稳定性
- ✅ 参数缓存的一致性

#### 7.8.6 测试数据要求
- **交易对**: BTC/USDT, ETH/USDT
- **配置范围**: 全部可配置参数
- **验证精度**: 参数精度要求
- **更新频率**: 实时或准实时
- **缓存时间**: 根据系统设计

#### 7.8.7 测试用例清单

**交易参数配置**

| 用例编号 | 用例名称 | 仓位模式 | 配置类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 125_Trade_C_TradingConfig | 全仓模式_交易参数配置 | Cross | 交易参数 | 交易限制和规则 |
| 126_Trade_I_TradingConfig | 逐仓模式_交易参数配置 | Isolated | 交易参数 | 交易限制和规则 |

**风险参数配置**

| 用例编号 | 用例名称 | 仓位模式 | 配置类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 127_Trade_C_RiskConfig | 全仓模式_风险参数配置 | Cross | 风险参数 | 风险控制阈值 |
| 128_Trade_I_RiskConfig | 逐仓模式_风险参数配置 | Isolated | 风险参数 | 风险控制阈值 |

**系统参数配置**

| 用例编号 | 用例名称 | 仓位模式 | 配置类型 | 验证重点 |
| :--- | :--- | :--- | :--- | :--- |
| 129_Trade_C_SystemConfig | 全仓模式_系统参数配置 | Cross | 系统参数 | 系统运行参数 |
| 130_Trade_I_SystemConfig | 逐仓模式_系统参数配置 | Isolated | 系统参数 | 系统运行参数 |

**说明**:
- 场景8共包含6条测试用例（125-130号）
- 覆盖配置类型(3) × 仓位模式(2) = 6条
- 每个用例都包含配置查询和参数验证测试

#### 7.8.8 详细测试用例

##### 用例125: 全仓模式_交易参数配置
- **用例编号**: 125_Trade_C_TradingConfig
- **用例名称**: 全仓模式_交易参数配置
- **所属场景**: 场景8 - 系统配置场景
- **用例描述**: 验证全仓模式下交易参数配置的查询和有效性验证
- **优先级**: P2

**前置条件**:
1. 系统正常运行，配置服务可用
2. 具有查询配置参数的权限
3. 交易对BTC/USDT正常开放

**测试步骤**:
1. 查询基础交易参数
   - 调用查询交易配置接口，获取BTC/USDT的交易参数
   - 验证最小交易数量、最大交易数量
   - 验证价格精度、数量精度
   - 验证价格波动限制（涨跌停板）
2. 查询手续费配置
   - 获取全仓模式下的手续费率
   - 验证Maker手续费和Taker手续费
   - 检查手续费计算方式和精度
3. 查询杠杆配置
   - 获取全仓模式支持的杠杆倍数范围
   - 验证最大杠杆倍数限制
   - 检查杠杆调整规则
4. 验证交易时间配置
   - 查询交易时间段设置
   - 验证维护时间窗口
   - 检查节假日交易安排
5. 测试参数应用
   - 使用配置参数执行实际交易
   - 验证参数限制的有效性
   - 测试边界值的处理
6. 配置一致性检查
   - 对比不同接口返回的相同参数
   - 验证配置缓存的一致性
   - 检查参数更新的同步性

**预期结果**:
1. 交易参数查询成功，数据完整
2. 手续费配置准确，计算正确
3. 杠杆配置合理，限制有效
4. 交易时间配置明确，规则清晰
5. 参数应用正确，限制生效
6. 配置一致性良好，无冲突

**关联接口**:
- 查询交易配置接口
- 查询手续费配置接口
- 查询杠杆配置接口
- 下单接口

##### 用例127: 全仓模式_风险参数配置
- **用例编号**: 127_Trade_C_RiskConfig
- **用例名称**: 全仓模式_风险参数配置
- **所属场景**: 场景8 - 系统配置场景
- **用例描述**: 验证全仓模式下风险控制参数的配置和有效性
- **优先级**: P2

**前置条件**:
1. 系统风险控制模块正常运行
2. 具有查询风险配置的权限
3. 账户有一定的交易历史

**测试步骤**:
1. 查询风险阈值配置
   - 调用查询风险配置接口，获取全仓风险参数
   - 验证保证金率阈值（警告线、强平线）
   - 检查风险等级划分标准
2. 查询强平配置
   - 获取强平触发条件
   - 验证强平执行策略
   - 检查强平手续费设置
3. 查询风险限制配置
   - 获取单笔交易限额
   - 验证日交易量限制
   - 检查持仓限额设置
4. 验证风险监控配置
   - 查询风险监控频率
   - 验证风险预警机制
   - 检查风险报告生成规则
5. 测试风险参数应用
   - 模拟接近风险阈值的交易
   - 验证风险控制的实时性
   - 测试风险预警的准确性
6. 配置查询性能测试
   - 验证配置查询的响应时间
   - 测试并发查询的稳定性
   - 检查配置缓存的有效性

**预期结果**:
1. 风险阈值配置合理，标准明确
2. 强平配置完整，策略有效
3. 风险限制设置适当，保护充分
4. 风险监控配置完善，覆盖全面
5. 风险参数应用正确，控制有效
6. 配置查询性能良好，响应及时

**关联接口**:
- 查询风险配置接口
- 风险控制接口
- 强平接口
- 查询账户余额接口

**备注**: 其他用例（126, 128-130）采用相似的测试逻辑，分别针对不同的配置类型和仓位模式进行验证，确保系统配置功能的完整性和可靠性。特别注意逐仓模式下的独立风险配置和参数差异化管理。

---

## 8. 测试用例设计总结

### 8.1 用例统计
- **P0优先级**: 64条用例（01-64号）- 核心功能
- **P1优先级**: 52条用例（65-116号）- 重要功能
- **P2优先级**: 14条用例（117-130号）- 辅助功能
- **总计**: 130条测试用例

### 8.2 场景覆盖
- **基础交易流程**: 场景1（32条）+ 场景4（8条）+ 场景2（24条）= 64条
- **高级功能**: 场景10（12条）+ 场景9（16条）+ 场景5（12条）+ 场景11（8条）+ 场景3（4条）= 52条
- **辅助功能**: 场景7（8条）+ 场景8（6条）= 14条

### 8.3 测试完整性
✅ **功能覆盖**: 涵盖交易系统的核心功能、重要功能和辅助功能
✅ **场景完整**: 从基础交易到高级管理，从数据一致性到系统配置
✅ **优先级明确**: P0/P1/P2三级优先级，确保核心功能优先验证
✅ **详细设计**: 每个场景都包含代表性的详细用例设计
✅ **实际可行**: 所有用例都基于系统实际功能设计，避免不存在的功能

**项目完成度**: 100% ✅
